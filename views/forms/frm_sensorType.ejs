<!-- Sensor Widget (Bootstrap + SB Admin 2) -->
<div id="frm_sensorType">
    <!-- Sensor Widget (Bootstrap 3.3.4 + SB Admin 2) -->
    <div class="panel panel-default" id="sensor-widget">
        <div class="panel-heading clearfix">
            <h4 class="panel-title pull-left" style="padding-top: 7.5px;">Sensor types</h4>
            <button class="btn btn-success btn-xs pull-right" id="add-sensor-btn">
                <i class="fa fa-plus"></i> Add New Sensor Type
            </button>
        </div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" id="sensor-table">
                    <!--<thead>-->
                    <!--<tr>-->
                        <!--<th>Sensor Name</th>-->
                    <!--</tr>-->
                    <!--</thead>-->

                    <tbody id="sensor-table-body">
                    <!-- MongoDB entries dynamically inserted here -->
                    <% sensors.forEach(function(sensor){ %>
                        <tr data-sensor="<%= sensor.sensor_type %>">
                            <td><%= sensor.sensor_type %></td>
                            <td class="text-right">
                                <button class="btn btn-danger btn-xs delete-sensor-btn">
                                    <i class="fa fa-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>


    // Handle "Add New Sensor"
    document.getElementById('add-sensor-btn').addEventListener('click', function() {
        var tbody = document.getElementById('sensor-table-body');

        // Create editable row
        var tr = document.createElement('tr');
        tr.innerHTML = `\
<td>\
  <input type="text" class="form-control input-sm" id="new-sensor-name" placeholder="Enter sensor type">\
</td>\
<td class="text-right">\
  <button class="btn btn-primary btn-xs" id="save-sensor-btn" disabled>Save</button>\
  <button class="btn btn-default btn-xs" id="cancel-sensor-btn">Cancel</button>\
</td>`;

        tbody.appendChild(tr);
        document.getElementById('new-sensor-name').focus();

        // Disable "Add" while editing
        document.getElementById('add-sensor-btn').disabled = true;

        const nameInput = document.getElementById('new-sensor-name');
        const saveBtn = document.getElementById('save-sensor-btn');

        // Enable Save only when field is filled
        function updateSaveState() {
            saveBtn.disabled = !nameInput.value.trim();
        }

        nameInput.addEventListener('input', updateSaveState);

        // Save new sensor
        document.getElementById('save-sensor-btn').addEventListener('click', function() {
            var new_sensorType = nameInput.value.trim();
            if (!new_sensorType) {
                alert('Please enter a type name.');
                return;
            }

            // Use AJAX to tell server to save it
            $.post("http://localhost:3000/api/addSensorType", { new_sensor_type: new_sensorType })
                .done(function() {
                    addSensorType(); // call to refresh
                })
                .fail(function(xhr) {
                    if (xhr.status === 409) {
                        alert("Sensor type already exists!");
                    } else {
                        alert("Error saving sensor type: " + xhr.statusText);
                    }
            });
        });

        // Cancel new entry
        document.getElementById('cancel-sensor-btn').addEventListener('click', function() {
            tr.remove();
            document.getElementById('add-sensor-btn').disabled = false;
        });
    });

    // Handle delete button clicks for existing sensor types
    document.getElementById('sensor-table-body').addEventListener('click', function(e) {
        if (e.target.closest('.delete-sensor-btn')) {
            const tr = e.target.closest('tr');
            const sensorType = tr.getAttribute('data-sensor');

            if (confirm(`Are you sure you want to delete "${sensorType}"?`)) {
                $.post("http://localhost:3000/api/deleteSensorType", { sensor_type: sensorType })
                        .done(function() {
                            addSensorType(); // refresh the table
                        })
                        .fail(function(xhr) {
                            alert("Error deleting sensor type: " + xhr.statusText);
                        });
            }
        }
    });


    // Initialize
    renderSensorType();
</script>

    <!-- Dependencies -->
    <!-- Bootstrap 3.3.4 + Font Awesome + jQuery + SB Admin 2 -->
    <!--<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">-->
    <!--<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>-->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/startbootstrap-sb-admin-2/1.0.8/js/sb-admin-2.min.js"></script>-->

    <!-- For the function that loads the form. Needed for Refresh. -->
    <script src="../Layout/js/scripts.js"></script>
